# Description : Free peer-reviewed portable C++ source libraries
# URL         : https://www.boost.org
# Maintainer  : camille, camille at lzr dot pw
# Depends on  : python3

name=boost
version=1.89.0
release=1
source=(
"https://archives.$name.io/release/$version/source/${name}_${version//./_}.tar.bz2"
any_iterator.patch
)

build() {
    cd "${name}_${version//./_}"

    patch -p 1 -i "$SRC/any_iterator.patch"

    prt-get isinst icu && local ICU=--with-icu

    ./bootstrap.sh                            \
        --prefix="$PKG/usr"                   \
        --with-toolset=gcc                    \
        --with-python="$(command -v python3)" \
        "$ICU"

    local python

    python=$(python3 -V)
    python=${python#* }
    python=${python%.*}

    ./b2 stage              \
        variant=release     \
        threading=multi     \
        runtime-link=shared \
        python="$python"    \
        link=shared,static  \
        debug-symbols=off   \
        -j "${JOBS:-1}"

    threading=multi link=shared ./b2 install
}

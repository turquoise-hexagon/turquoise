# Description : SPIRV-tools
# URL         : https://www.khronos.org/registry/spir-v
# Maintainer  : camille, camille at lzr dot pw
# Depends on  : clang spirv-headers

name=spirv-tools
commit=1a0658f55aab97e1803ca46896596a04c395d50d
version=20241228
release=1
source=("https://github.com/khronosgroup/$name/archive/$commit.tar.gz")

build() {
    cd "SPIRV-Tools-$commit"

    local -a flags

    flags=(
        -G Ninja
        -D CMAKE_BUILD_TYPE=release
        -D CMAKE_INSTALL_LIBDIR=lib
        -D CMAKE_INSTALL_PREFIX=/usr
        -D SPIRV-Headers_SOURCE_DIR=/usr
        -D SPIRV_TOOLS_BUILD_STATIC=off
        -D SPIRV_WERROR=off
        -D CMAKE_C_FLAGS_RELEASE="$CFLAGS"
		-D CMAKE_CXX_FLAGS_RELEASE="$CXXFLAGS"
        -Wno-dev
    )

    cmake -B build-shared "${flags[@]}" -D BUILD_SHARED_LIBS=on
    cmake -B build-static "${flags[@]}" -D BUILD_SHARED_LIBS=off
    DESTDIR="$PKG" cmake --build build-shared --target install
    DESTDIR="$PKG" cmake --build build-static --target install
}

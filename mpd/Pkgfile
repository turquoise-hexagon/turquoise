# Description : A flexible, powerful, server-side application for playing music
# URL         : https://www.musicpd.org
# Maintainer  : camille, camille at lzr dot pw
# Depends on  : meson ninja python3 python3-pip boost fmt

name=mpd
_commit=4c08c0b8b1006709cff5bad8421a355479b1111c
version=0.23.8
release=3
source=(
"https://github.com/musicplayerdaemon/$name/archive/$_commit.tar.gz"
"$name"
)

build() {
    cd "${name^^}-$_commit"

    # install sphinx locally
    local venv_dir=.venv

    mkdir -p "$venv_dir"
    python3 -m venv "$venv_dir"

    . "$venv_dir/bin/activate"

    pip3 -qqq install -U pip sphinx

    # build & install
    meson . build     \
        --prefix=/usr \
        --sysconfdir=/etc

    meson compile -C build -j "${JOBS:-1}"
    DESTDIR="$PKG" meson install -C build

    install -Dm644 "doc/${name}conf.example" "$PKG/etc/$name/$name.conf"
    install -Dm755 "$SRC/$name" "$PKG/etc/rc.d/$name"

    rm -rf "$PKG/usr/share/doc"
}
